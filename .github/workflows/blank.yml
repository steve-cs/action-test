name: CI
on:
  push:
  schedule:
    - cron:  '0 12 * * *'
jobs:
  job1:
    runs-on: ubuntu-18.04
    container: 
      image: docker://ubuntu:18.04
    env:
      DEBIAN_FRONTEND: noninteractive
    steps:
    - name: Makefile
      run: |
        apt-get update
        apt-get -qq -y install git make
        git clone https://github.com/steve-cs/gnat-builder.git
        cp gnat-builder/Makefile .

    - name: Depends
      run: make depends

    - name: GCC
      run: make gcc gcc-install gcc-build-clean

    - name: GPRbuild bootstrap
      run: make gprbuild-bootstrap-install 

    - name: XML/Ada
      run: make xmlada xmlada-install xmlada-clean

    - name: GPRBUILD
      run: make gprbuild gprbuild-install gprbuild-clean

    - name: GNATColl
      run: |
        make gnatcoll-core gnatcoll-core-install gnatcoll-core-clean
        make gnatcoll-bindings gnatcoll-bindings-install gnatcoll-bindings-clean
        make gnatcoll-sql gnatcoll-sql-install
        make gnatcoll-db-build
        make gnatcoll-gnatcoll_db2ada gnatcoll-gnatcoll_db2ada-install
        make gnatcoll-sqlite gnatcoll-sqlite-install
        make gnatcoll-xref gnatcoll-xref-install
        make gnatcoll-gnatinspect gnatcoll-gnatinspect-install
        make gnatcoll-db-clean
    - name: LibAdaLang
      run: make libadalang libadalang-install libadalang-clean langkit-clean

    - name: GTKAda
      run: make gtkada gtkada-install gtkada-clean

    - name: GPS
      run: make gps gps-install gps-clean libadalang-tools-clean ada_language_server-clean

    - name: SPARK 2014
      run: make spark2014 spark2014-install spark2014-clean
